New-Item -Path "HKLM:\Software\Policies\Microsoft\Windows\DataCollection" -Force
Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\DataCollection" -Name "AllowTelemetry" -Value 0

New-Item -Path "HKLM:\Software\Policies\Microsoft\SQMClient\Windows" -Force
Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\SQMClient\Windows" -Name "CEIPEnable" -Value 0

New-Item -Path "HKLM:\Software\Policies\Microsoft\Windows\Feedback" -Force
Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\Feedback" -Name "DoNotShowFeedbackNotifications" -Value 1

Stop-Service diagtrack -Force
Set-Service diagtrack -StartupType Disabled

Stop-Service dmwappushsvc -Force
Set-Service dmwappushsvc -StartupType Disabled

Add-Content -Path "C:\Windows\System32\drivers\etc\hosts" -Value "0.0.0.0 vortex.data.microsoft.com"
Add-Content -Path "C:\Windows\System32\drivers\etc\hosts" -Value "0.0.0.0 settings-win.data.microsoft.com"
Add-Content -Path "C:\Windows\System32\drivers\etc\hosts" -Value "0.0.0.0 watson.telemetry.microsoft.com"
Add-Content -Path "C:\Windows\System32\drivers\etc\hosts" -Value "0.0.0.0 telemetry.microsoft.com"
Add-Content -Path "C:\Windows\System32\drivers\etc\hosts" -Value "0.0.0.0 ssw.live.com"

Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\Windows Search" -Name "AllowCortana" -Value 0

Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Search" -Name "CortanaConsent" -Value 0
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Search" -Name "BingSearchEnabled" -Value 0
